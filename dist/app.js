!function(t){var e={};function n(i){if(e[i])return e[i].exports;var r=e[i]={i:i,l:!1,exports:{}};return t[i].call(r.exports,r,r.exports,n),r.l=!0,r.exports}n.m=t,n.c=e,n.d=function(t,e,i){n.o(t,e)||Object.defineProperty(t,e,{enumerable:!0,get:i})},n.r=function(t){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},n.t=function(t,e){if(1&e&&(t=n(t)),8&e)return t;if(4&e&&"object"==typeof t&&t&&t.__esModule)return t;var i=Object.create(null);if(n.r(i),Object.defineProperty(i,"default",{enumerable:!0,value:t}),2&e&&"string"!=typeof t)for(var r in t)n.d(i,r,function(e){return t[e]}.bind(null,r));return i},n.n=function(t){var e=t&&t.__esModule?function(){return t.default}:function(){return t};return n.d(e,"a",e),e},n.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},n.p="",n(n.s=0)}([function(t,e,n){"use strict";n.r(e);var i="http://132.232.237.100:3000";function r(t){return"https://y.gtimg.cn/music/photo_new/T002R150x150M000".concat(t,".jpg")}function o(t){var e=function(t){return"".concat(i,"/getvkey?songmid=").concat(t)}(t);return fetch(e).then(function(t){return t.json()}).then(function(t){return t.data.items[0].vkey})}function s(t){var e=function(t){return"".concat(i,"/getLyric?musicid=").concat(t)}(t);return fetch(e).then(function(t){return t.json()})}function a(){return fetch("".concat(i,"/gethoukey")).then(function(t){return t.json()}).catch(function(t){new Error(t)})}function c(){return fetch("".concat(i,"/Rec")).then(function(t){return t.json()}).catch(function(t){new Error(t)})}function l(){return fetch("".concat(i,"/Rank")).then(function(t){return t.json()}).catch(function(t){new Error(t)})}function u(t){return fetch(function(t){return"".concat(i,"/search?w=").concat(t)}(t)).then(function(t){return t.json()})}function h(t){var e=function(t){return"".concat(i,"/getTopList?topId=").concat(t)}(t);return fetch(e).then(function(t){return t.json()}).catch(function(t){new Error(t)})}function d(t){var e=function(t){return"".concat(i,"/getSonglist?id=").concat(t)}(t);return fetch(e).then(function(t){return t.json()})}function f(t){var e=function(t){return"".concat(i,"/getRadioList?id=").concat(t)}(t);return fetch(e).then(function(t){return t.json()}).catch(function(t){new Error(t)})}function y(t,e){for(var n=0;n<e.length;n++){var i=e[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,i.key,i)}}var g=function(){function t(e){var n=e.$el,i=e.interval,r=void 0===i?4e3:i,o=e.slides;!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),this.$elWrap=n,this.slides=o,this.length=o.length,this.index=1,this.interval=r,this.rander(),this.move()}var e,n,i;return e=t,(n=[{key:"rander",value:function(){this.$elWrap.innerHTML='<ul class="slide-content"></ul> ',this.$el=this.$elWrap.firstElementChild,this.$el.style.width="".concat(100*this.length,"%"),this.$el.innerHTML=this.slides.map(function(t){return'<li class="slide-item"><img src="'.concat(t.picUrl,'" alt=""></li>')}).join("")}},{key:"move",value:function(){var t=this;setInterval(function(){t.index===t.length&&(t.index=0),t.$el.style.transform="translate(-".concat(t.index++/t.length*100,"%)")},this.interval)}}])&&y(e.prototype,n),i&&y(e,i),t}();function m(t,e){for(var n=0;n<e.length;n++){var i=e[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,i.key,i)}}var p=new(function(){function t(){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),this.$topList=document.querySelector(".toplist"),this.$topListUl=this.$topList.querySelector(".list"),this.$topListImg=this.$topList.querySelector(".toplist-img"),this.$topListBack=this.$topList.querySelector(".back"),this.$topListBack.addEventListener("click",this.hide.bind(this))}var e,n,i;return e=t,(n=[{key:"resetTopList",value:function(t){this.$topListImg.src=t.pic,this.$topListUl.innerHTML=this.randerLi(t.songlist),this.show()}},{key:"randerLi",value:function(t){return(t=t.slice(0,100)).reduce(function(t,e,n,i){var r=e.singer.map(function(t){return t.name}).join(" ");return t+'\n            <li class="item">\n                <a href="#player?songid='.concat(e.songid,"&artist=").concat(r,"&songmid=").concat(e.songmid,"&songname=").concat(e.songname,"&albummid=").concat(e.albummid,'">            \n                    <span class="ranking">').concat(n+1,"</span>\n                    <div class='item-info'>\n                        <p class=\"song-name\">").concat(e.songname,'</p>\n                        <p class="singer">').concat(e.singer.map(function(t){return t.name}).join("/"),"</p> \n                    </div>\n                </a>\n            </li>\n           ")},"")}},{key:"hide",value:function(){this.$topList.classList.remove("show")}},{key:"show",value:function(){this.$topList.classList.add("show")}}])&&m(e.prototype,n),i&&m(e,i),t}());function v(t){var e,n,i,r,o=Array.from(t);if("IntersectionObserver"in window){var s=new IntersectionObserver(function(t){t.forEach(function(t){t.intersectionRatio>0&&(a(t.target),s.unobserve(t.target))})});o.forEach(function(t){s.observe(t)})}else throttleLazyloadFn=(e=function(){0===o.length&&window.removeEventListener("scroll",throttleLazyloadFn),o=o.filter(function(t){return e=t,n=window.innerWidth,i=window.innerHeight,!(e.getBoundingClientRect().top<=i&&e.getBoundingClientRect().bottom>=0&&e.getBoundingClientRect().left<=n&&e.getBoundingClientRect().right>=0)||(a(t),!1);var e,n,i})},n=100,function(){var t=Date.now(),o=t-i;!i||o>=n?(e(),i=t):o<n&&(clearTimeout(r),r=setTimeout(e,n-o))}),window.addEventListener("scroll",throttleLazyloadFn),window.dispatchEvent(new Event("scroll"));function a(t){t.src=t.dataset.lazyload}}function $(t,e){for(var n=0;n<e.length;n++){var i=e[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,i.key,i)}}var k=new(function(){function t(){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),this.$el=document.querySelector(".loading")}var e,n,i;return e=t,(n=[{key:"show",value:function(){this.$el.style.display="flex"}},{key:"hide",value:function(){this.$el.style.display="none"}}])&&$(e.prototype,n),i&&$(e,i),t}());function w(t,e){for(var n=0;n<e.length;n++){var i=e[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,i.key,i)}}var b=function(){function t(){var e=this;!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),this.$radio=document.querySelector("[data-radio-view]"),this.$songList=document.querySelector("[data-hotSongList-view]"),this.$radio.addEventListener("click",this.linkRadioList.bind(this)),this.$songList.addEventListener("click",this.linkSongList.bind(this)),c().then(function(t){e.init(t.data)})}var e,n,i;return e=t,(n=[{key:"init",value:function(t){var e=t.slider,n=t.radioList,i=t.songList;this.randerSlider(e),this.randerRadio(n),this.randerHot(i),document.querySelector(".first-loading").style.display="none",document.querySelector(".main").style.display="block"}},{key:"randerSlider",value:function(t){new g({$el:document.querySelector(".slide-wrap"),slides:t})}},{key:"randerRadio",value:function(t){this.$radio.innerHTML=t.reduce(function(t,e){return t+'\n        <li class="item" data-id='.concat(e.radioid,' data-picurl="').concat(e.picUrl,'">\n            <div class="item-media">\n            <img src="./static/loading.gif" alt="" data-lazyload="').concat(e.picUrl,'">\n                <span class="play-btn"></span>\n            </div>\n            <div class="msg">\n                ').concat(e.Ftitle,"\n            </div>\n        </li>")},""),v(this.$radio.querySelectorAll("[data-lazyload]"))}},{key:"linkRadioList",value:function(t){for(var e=t.target,n=t.currentTarget;!e.matches(".item")&&e!=n;)e=e.parentNode;k.show(),f(e.dataset.id).then(function(t){var n={};n.pic=e.dataset.picurl,n.songlist=t.songlist.data.track_list.map(function(t){var e={};return e.singer=t.singer,e.songid=t.id,e.songmid=t.mid,e.songname=t.name,e.albummid=t.album.mid,e}),p.resetTopList(n),k.hide()})}},{key:"linkSongList",value:function(t){for(var e=t.target,n=t.currentTarget;!e.matches(".item")&&e!=n;)e=e.parentNode;k.show(),d(e.dataset.id).then(function(t){console.log(t);var e={};e.pic=t.cdlist[0].logo,e.songlist=t.cdlist[0].songlist,p.resetTopList(e),k.hide()})}},{key:"randerHot",value:function(t){var e=this;this.$songList.innerHTML=t.reduce(function(t,n){return t+'\n        <li class="item" data-id="'.concat(n.id,'">\n            <div class="item-media">\n                <img src="./static/loading.gif" alt="" data-lazyload="').concat(n.picUrl,'">\n                <span class="play-btn"></span>\n                <span class="listen-count">').concat(e.formatNum(n.accessnum),'</span>\n            </div>\n            <div class="msg">\n                <p class="msg-tit ellipsis">').concat(n.songListDesc,'</p>\n                <p class="msg-text ellipsis">').concat(n.songListAuthor,"</p>\n            </div>\n        </li>")},""),v(this.$songList.querySelectorAll("[data-lazyload]"))}},{key:"formatNum",value:function(t){return t>1e4?(t/1e4).toFixed(1)+"万":t>1e3?(t/1e3).toFixed(1)+"千":""}}])&&w(e.prototype,n),i&&w(e,i),t}();function L(t,e){for(var n=0;n<e.length;n++){var i=e[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,i.key,i)}}var S=function(){function t(){var e=this;!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),this.$el=document.querySelector(".rank-view"),this.$list=document.querySelector("[data-rankList-view]"),l().then(function(t){e.initRank(t.data.topList)}),this.$list.addEventListener("click",this.linkTopList.bind(this))}var e,n,i;return e=t,(n=[{key:"initRank",value:function(t){var e=this;this.$list.innerHTML=t.reduce(function(t,n){return t+'\n            <li class="topic-item" data-id='.concat(n.id,'>\n                <div class="item-media">\n                    <img src="./static/loading.gif" alt="" data-lazyload="').concat(n.picUrl,'">\n                    <div class="listen-count">').concat(n.accessnum,'</div>\n                </div>\n                <div class="item-info">\n                    <h2 class="item-title">').concat(n.topTitle,'</h2>\n                    <ul class="item-cont">').concat(e.childView(n.songList),'\n                    </ul>\n                </div>\n                <div class="topic-more"></div>\n            </li>')},""),v(this.$list.querySelectorAll("[data-lazyload]"))}},{key:"linkTopList",value:function(t){for(var e=t.target,n=t.currentTarget;!e.matches(".topic-item")&&e!=n;)e=e.parentNode;k.show(),h(e.dataset.id).then(function(t){var e={};e.pic=t.topinfo.pic_v12,e.songlist=t.songlist.map(function(t){return t.data}),p.resetTopList(e),k.hide()})}},{key:"childView",value:function(t){return t.reduce(function(t,e,n,i){return t+'\n            <li class="item-song ellipsis">\n                '.concat(n+1,'\n                <span class="song-name">').concat(e.songname,"</span>\n                ").concat(e.singername,"\n            </li>\n        ")},"")}}])&&L(e.prototype,n),i&&L(e,i),t}();function T(t,e){for(var n=0;n<e.length;n++){var i=e[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,i.key,i)}}var E=function(){function t(){var e=this;!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),this.$searchInp=document.getElementById("searchInp"),this.$clearBtn=document.getElementById("clearBtn"),this.$hotSearch=document.getElementById("hotSearch"),this.$historySearch=document.getElementById("historySearch"),this.$searchCon=document.getElementById("searchCon"),this.$loading=document.querySelector(".search-loading"),this.$hotView=document.querySelector("[data-hotSearch-view]"),this.$HistoryView=document.querySelector("[data-history-view]"),this.$SearchConView=document.querySelector("[data-searchCon-view]"),this.$searchInp.addEventListener("focus",this.onInpFocus.bind(this)),this.$searchInp.addEventListener("keyup",this.onInpkeyup.bind(this)),this.$clearBtn.addEventListener("click",this.onClear.bind(this)),this.$HistoryView.addEventListener("click",this.onHistoryEntrust.bind(this)),this.$hotView.addEventListener("click",this.onHotKeyEntrust.bind(this)),this.songData=null,a().then(function(t){e.randerHotKey(t.data)})}var e,n,i;return e=t,(n=[{key:"randerHotKey",value:function(t){var e=t.hotkey;this.$hotView.innerHTML=e.slice(0,6).reduce(function(t,e){return t+"\n            <li>\n                ".concat(e.k,"\n            </li>")},"")}},{key:"randerHistory",value:function(){this.getStorage()&&(this.$HistoryView.innerHTML=this.getStorage().reduce(function(t,e){return t+'\n            <li class="history-item">\n                <i class="history-icon"></i>\n                <p class="history-con">'.concat(e,'</p>\n                <i class="history-close"></i>\n            </li>')},""))}},{key:"randerSearchList",value:function(t){var e=this;this.$SearchConView.innerHTML=t.reduce(function(t,n){var i=n.singer.map(function(t){return t.name}).join(" ");return t+'\n        <li class="search-item">\n            <a href="#player?songid='.concat(n.songid,"&artist=").concat(i,"&songmid=").concat(n.songmid,"&songname=").concat(n.songname,"&albummid=").concat(n.albummid,'">            \n                <i class="song-icon"></i>\n                <div class="search-info">\n                    <p class="song-name">').concat(n.songname,'</p>\n                    <p class="singer">').concat(e.handleSingerName(n.singer),"</p>\n                </div>\n            </a>\n        </li>")},"")}},{key:"onInpFocus",value:function(t){this.randerHistory(),this.$historySearch.style.display="block",this.$hotSearch.style.display="none",this.$searchCon.style.display="none"}},{key:"onClear",value:function(){searchInp.value="",this.$historySearch.style.display="none",this.$hotSearch.style.display="block",this.$searchCon.style.display="none"}},{key:"onInpkeyup",value:function(t){"Enter"===t.key&&""!==t.target.value.trim()&&this.search(t.target.value)}},{key:"setStorage",value:function(t){var e=this.getStorage();e?(e.includes(t)&&e.splice(e.indexOf(t),1),e=","+e):e="";var n=t+e;localStorage.setItem("search_history",n)}},{key:"getStorage",value:function(){return!!localStorage.getItem("search_history")&&localStorage.getItem("search_history").split(",")}},{key:"removeStorage",value:function(t){var e=this.getStorage();e.splice(e.indexOf(t),1),localStorage.setItem("search_history",e)}},{key:"onHistoryEntrust",value:function(t){var e=t.target;e.matches(".history-close")?(this.removeStorage(e.previousElementSibling.innerText),e.parentNode.parentNode.removeChild(e.parentNode),e=null):e.matches(".history-con")&&this.search(e.innerText)}},{key:"onHotKeyEntrust",value:function(t){this.search(t.target.innerText)}},{key:"search",value:function(t){var e=this;this.$searchInp.value=t,this.$historySearch.style.display="none",this.$hotSearch.style.display="none",this.$searchCon.style.display="block",this.$loading.style.display="block",u(t).then(function(n){e.$loading.style.display="none",e.setStorage(t),e.randerSearchList(n.data.song.list)}).catch(function(t){console.log(t)})}},{key:"handleSingerName",value:function(t){return 1===t.length?t[0].name:t.reduce(function(t,e){return"".concat(t.name," / ").concat(e.name)})}}])&&T(e.prototype,n),i&&T(e,i),t}();function q(t,e){for(var n=0;n<e.length;n++){var i=e[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,i.key,i)}}new E;var C=function(){function t(e){var n=e.$el;e.songTime;!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),this.$songTime=n.querySelector(".song-time"),this.$playTime=n.querySelector(".play-time"),this.$progress=n.querySelector(".progress-bar-progress")}var e,n,i;return e=t,(n=[{key:"onPlaying",value:function(t){var e=t.currentTime,n=t.songTime;this.$progress.style.width="".concat(e/n*100,"%"),e=this.formatTime(e),n=this.formatTime(n),this.$songTime.innerText=n,this.$playTime.innerText=e}},{key:"reseter",value:function(){this.$progress.style.width=0,this.$songTime.innerText="00: 00",this.$playTime.innerText="00: 00"}},{key:"formatTime",value:function(t){var e=parseInt(t/60)||0;e=e>=10?e:"0"+e;var n=parseInt(t%60)||0;return e+":"+(n=n>=10?n:"0"+n)}}])&&q(e.prototype,n),i&&q(e,i),t}();function x(t,e){for(var n=0;n<e.length;n++){var i=e[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,i.key,i)}}var I=function(){function t(){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),this.$el=document.querySelector(".lyric-list"),this.$lyricLoading=document.querySelector(".lyric-loading"),this.$item=[],this.lyricList=[],this.times=[],this.currIndex=0,this.translateY=0,this.middle=4,this.lyricOk=!1}var e,n,i;return e=t,(n=[{key:"reseter",value:function(t){this.currIndex=0,this.lyricList=[],this.times=[],this.lyricOk=!1,this.$el.innerHTML="",this.$lyricLoading.style.display="none"}},{key:"randerLyric",value:function(t){var e=this;if(t){(t=this.formatText(t)).match(/^\[\d{2}:\d{2}[\.|:]\d{2}\](.+)$/gm).forEach(function(t){e.times.push(e.formatTime(t.slice(1,9))),e.lyricList.push(t.slice(10))});var n="";this.lyricList.forEach(function(t){n+='<li class="ellipsis">'.concat(t,"</li>")}),this.$el.innerHTML=n,this.$item=this.$el.querySelectorAll("li"),this.move(0),this.$lyricLoading.style.display="blick",this.lyricOk=!0}}},{key:"animation",value:function(t){if(t&&this.lyricOk){for(;t>this.times[this.currIndex+1]&&this.times[this.currIndex+1];)this.currIndex++;this.highlightLyric(),this.currIndex>this.middle&&this.move(30*-(this.currIndex-this.middle))}}},{key:"highlightLyric",value:function(){this.$el.querySelector(".active")&&this.$el.querySelector(".active").classList.remove("active"),this.$item[this.currIndex].classList.add("active")}},{key:"move",value:function(t){var e=this.$el.getBoundingClientRect().height-this.$el.parentNode.getBoundingClientRect().height;this.$el.style.transform="translateY(".concat(t<-e?-e:t,"px)")}},{key:"formatText",value:function(t){var e=document.createElement("div");return e.innerHTML=t,e.innerHTML}},{key:"formatTime",value:function(t){return 60*Number(t.split(":")[0])+Number(t.split(":")[1])}}])&&x(e.prototype,n),i&&x(e,i),t}();function j(t,e){for(var n=0;n<e.length;n++){var i=e[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,i.key,i)}}var H,O,B,M,R=function(){function t(){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),this.$el=document.querySelector(".player"),this.$toggleBtn=this.$el.querySelector(".toggle-btn"),this.$pic=this.$el.querySelector(".song-pic"),this.$playerBg=this.$el.querySelector(".player-bg"),this.$up=this.$el.querySelector(".up"),this.$songName=this.$el.querySelector(".song-name"),this.$singer=this.$el.querySelector(".singer"),this.$progress=this.$el.querySelector(".progress"),this.$audio=this.$el.querySelector("#audio"),this.progressComp=new C({$el:this.$progress}),this.lyricComp=new I,this.$phonogram=document.querySelector(".player-open"),this.$audio.addEventListener("timeupdate",this.timeupdate.bind(this)),this.$toggleBtn.addEventListener("click",this.toggleSong.bind(this)),this.$up.addEventListener("click",this.hide.bind(this)),window.addEventListener("hashchange",this.onHashChange.bind(this)),this.$phonogram.addEventListener("click",this.show.bind(this))}var e,n,i;return e=t,(n=[{key:"timeupdate",value:function(t){var e=t.target;this.progressComp.onPlaying({currentTime:e.currentTime,songTime:e.duration}),this.lyricComp.animation(e.currentTime)}},{key:"reseter",value:function(t){var e=this,n=t.songid,i=t.songname,a=t.songmid,c=t.albummid,l=t.artist;this.$phonogram.style.display="block",this.$phonogram.querySelector("img").src=r(c),this.progressComp.reseter(),this.$pic.src=r(c),this.$playerBg.style.backgroundImage="url('".concat(r(c),"')"),this.$songName.innerText=i,this.$singer.innerText=l,this.lyricComp.reseter(),o(a).then(function(t){e.$audio.src=function(t,e){return"http://dl.stream.qqmusic.qq.com/C400".concat(t,".m4a?guid=2921477192&vkey=").concat(e,"&uin=0&fromtag=38")}(a,t),e.play()}),s(n).then(function(t){e.lyricComp.randerLyric(t.lyric)})}},{key:"onHashChange",value:function(){var t=location.hash;if(/^#player\?.+/.test(t)){var e=t.slice(t.indexOf("?")+1).match(/(\w+)=([^&]+)/g),n=e&&e.reduce(function(t,e){var n=e.split("=");return t[n[0]]=decodeURIComponent(n[1]),t},{});this.show(),this.reseter(n)}else this.hide()}},{key:"toggleSong",value:function(t){t.target.matches(".play")?this.pause():this.play()}},{key:"play",value:function(){try{this.$audio.play(),this.$toggleBtn.classList.add("play"),this.$phonogram.classList.add("play")}catch(t){console.log(t),console.log("需要用户手动播放")}}},{key:"pause",value:function(){this.$audio.pause(),this.$toggleBtn.classList.remove("play"),this.$phonogram.classList.remove("play")}},{key:"show",value:function(){this.$el.classList.add("show")}},{key:"hide",value:function(){this.$el.classList.remove("show")}}])&&j(e.prototype,n),i&&j(e,i),t}();new b,new S,new E,new R,H={link:document.querySelector(".nav-list"),view:document.querySelector(".main")},O=H.link,B=H.view,M=O.firstElementChild,O.addEventListener("click",function(t){t.target!==M&&(t.target.classList.add("active"),B.querySelector("[data-view = '".concat(t.target.dataset.to,"']")).classList.add("show"),M.classList.remove("active"),B.querySelector("[data-view = '".concat(M.dataset.to,"']")).classList.remove("show"),M=t.target)})}]);